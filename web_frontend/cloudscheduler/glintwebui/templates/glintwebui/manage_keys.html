<head>
<meta http-equiv="refresh" content="60">
{% load static %}
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<link rel="stylesheet" type="text/css" href="{% static "csv2/common.css" %}">
<link rel="stylesheet" type="text/css" href="{% static "csv2/clouds.css" %}">
<link rel="stylesheet" href="/static/glintwebui/css/glint_button.css">
<link rel="stylesheet" href="/static/glintwebui/css/glint_header_footer.css">
<link rel="stylesheet" href="/static/glintwebui/css/glint_matrix.css">
<link rel="stylesheet" href="/static/glintwebui/css/glint_dropdown_button.css">

<style>

{% load glint_template_utils %}

.header_table{
    border: 0;
}

</style>
</head>
{% block navbar %}
    {% include "csv2/navigation_bar.html" %}
{% endblock %}
<div class="wrapper" style="padding-top:60px">
    <div id="page_header">
         <table class="header_table" border="0">
             <tr class="header_table">
                 <th class="header_table"><h1 style="float:left">User Keys</h1></th>
                 <td class="header_table" style="background-color: #fffeea; border:none"> <input type="text" id="image_search" autofocus="autofocus" placeholder="Search by Key Name"> </td>
                 <td class="header_table"><input stlye="float:left" class="button greenbutton" style="height:44px;" type="submit" onclick="uploadKey()" value="+Upload Key" /></td>
                 <td class="header_table"><input stlye="float:left" class="button greenbutton" style="height:44px;" type="submit" onclick="createKey()" value="New Key" /></td>
                 <td class="header_table"><input stlye="float:left" class="button greenbutton" style="height:44px;" type="submit" onclick="submitKeyMatrix()" value="Submit Changes" /></td>
             </tr>
         </table>
    </div>
<div class="image_matrix">
    <form id="keypair_form" name="keypair_form" action="/images/save_keypairs/{{active_group}}/" method="post">
    {% csrf_token %}
    <table>
        <tr>
            <th>Keys\Clouds</th>
            {% for cloud in group_resources %}
                <th>{{cloud.cloud_name}}</th>
            {% endfor %}
        </tr>
        {% for key in fingerprint_dict %}
            <tr class="key_row">
                <th>
                    {{fingerprint_dict|get_item:key|get_item:"name"}}
                </th>
                {% for cloud in group_resources %}
                    {% if fingerprint_dict|get_item:key|get_item:cloud.cloud_name %}
                        <td class="{{key}}"><input name="{{cloud.cloud_name}}" type="checkbox" value="{{key}}" checked></td>
                    {% else %}
                        <td class="{{key}}"><input name="{{cloud.cloud_name}}" type="checkbox" value="{{key}}" ></td>
                    {% endif %}
                {% endfor %}
            </tr>
        {% endfor %}
    </table>
</form></div>
</div>

<script>
function submitKeyMatrix(){
    document.getElementById("keypair_form").submit();
}
function createKey(){
    return 0
}
function uploadKey(){
    return 0
}

var $rows = $('.key_row');
var val = $.trim($('#image_search').val()).replace(/ +/g, ' ').toLowerCase();
$rows.filter(function() {
    var text = $(this).text().replace(/\s+/g, ' ').toLowerCase();
    return !~text.indexOf(val);
}).hide();

$('#image_search').keyup(function() {
    var filter = localStorage.getItem("filter");
    var $rows = $('.key_row');
    var val = $.trim($(this).val()).replace(/ +/g, ' ').toLowerCase();
    $rows.show().filter(function() {
        var text = $(this).text().replace(/\s+/g, ' ').toLowerCase();
        return !~text.indexOf(val);
    }).hide();
});
</script>
