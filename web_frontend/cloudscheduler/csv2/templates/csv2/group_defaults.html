

{% block navbar %}
   {% include "csv2/navigation_bar.html" %}
{% endblock %}

<head>
    {% load template_utils %}
    {% load static %}
    <link rel="stylesheet" type="text/css" href="{% static "csv2/common.css" %}">
    <link rel="stylesheet" type="text/css" href="{% static "csv2/groups.css" %}">
    <link rel="stylesheet" type="text/css" href="{% static "csv2/clouds.css" %}">
    <link rel="stylesheet" type="text/css" href="{% static "csv2/editor.css" %}">

    <script type="text/javascript" src="{% static "csv2/common.js" %}"></script>
    <script rel="preload" type="text/javascript" src="{% static "ace-builds/src-noconflict/ace.js" %}"></script>
    
    <script type="text/javascript">

        var visited = {};

        function meta_fetch(groupname , metaname) {

            var url='/group/metadata-fetch?{{active_group}}&metadata_name='+metaname
            var frame='editor-'+groupname+'-'+metaname

            if (!visited[frame]){
                document.getElementById(frame).src=url;
                visited[frame]=1;
            }
        }

        function meta_add() {

            var url='/group/metadata-new?{{active_group}}'
            var frame='editor-add'

            document.getElementById(frame).src=url;
        }

        function check_target(targetname) {

            var frame=targetname;
            
            document.getElementById(frame).checked = true;
        }

        function show_group(group_name){
            if (group_name.length > 0) {
                document.location.hash = group_name;
            }
        }
    </script>

</head>

<body class="defaults-nav" onpageshow="show_group('{{active_group}}') ; check_target('{{default_list.0.group_name}}-settings')">
<!--https://www.w3.org/Style/Examples/007/target.en.html#tab1-->
<div class="main-div">
    <div class="menu">

    {% for group in defaults_list %}

        <!--https://codepen.io/nathanlong/pen/mBrvn-->
        
        <div id="{{group.group_name}}"> <a href="#{{group.group_name}}" class="menu-link" onclick="check_target('{{group.group_name}}-settings') ; check_target('{{group.group_name}}-hide')">{{group.group_name}}</a>
            
            <div class="menu-target">

                <div class="tab">
                    <input id="{{group.group_name}}-settings" type="radio" name="tabs" onclick="check_target('{{group.group_name}}-hide')" checked>
                    <label class="highlight3" for="{{group.group_name}}-settings">Settings</label>
                    <div class="tab-content">

                        <form name="{{group.group_name}}" action="/group/defaults/" method="post">
                        {% csrf_token %}
                        
                        

                            <input type="hidden" name="group" value="{{group.group_name}}" />
                            <table>



                                <tr class="highlight3"><td><label for="htcondor_fqdn">HTCondor FQDN</label></td>
                                <td><input type="text" name="htcondor_fqdn" value="{{group.htcondor_fqdn}}" /></td></tr>


                                <tr class="highlight3"><td><label for="htcondor_container_hostname">HTCondor container hostname</label></td>
                                <td><input type="text" name="htcondor_container_hostname" value="{{group.htcondor_container_hostname}}" /></td></tr>

                                <tr class="highlight3"><td><label for="htcondor_other_submitters">HTCondor other submitters</label></td>
                                <td><input type="text" name="htcondor_other_submitters" value="{{group.htcondor_other_submitters}}" /></td></tr>



                                <tr class="highlight3"><td><label for="job_cpus">Job CPUs</label></td>
                                <td><input type="text" name="job_cpus" value="{{group.job_cpus}}" /></td></tr>

                                <tr class="highlight3"><td><label for="job_ram">Job RAM</label></td>
                                <td><input type="text" name="job_ram" value="{{group.job_ram}}" /></td></tr>


                                <tr class="highlight3"><td><label for="job_disk">Job Disk</label></td>
                                <td><input type="text" name="job_disk" value="{{group.job_disk}}" /></td></tr>

                                <!--<tr class="highlight3"><td><label for="job_scratch">Job Scratch</label></td>
                                <td><input type="text" name="job_scratch" value="{{group.job_scratch}}" /></td></tr>-->

                                <tr class="highlight3"><td><label for="job_swap">Job Swap</label></td>
                                <td><input type="text" name="job_swap" value="{{group.job_swap}}" /></td></tr>

                                <tr class="highlight3"><td><label for="vm_keyname">VM Keyname</label></td>
                                <td><select name="vm_keyname" class="dropdown"/>
                                <option value=""></option>
                                {% for key in keypairs_list %}
                                    {% if key.key_name == group.vm_keyname %}
                                        <option value="{{ key.key_name }}" selected>{{ keyname.name }}</option>
                                    {% else %}
                                        <option value="{{ key.key_name }}">{{ key.key_name }}</option>
                                    {% endif %}
                                {% endfor %}


                                <tr class="highlight3"><td><label for="vm_image">VM Image</label></td>
                                <td><select name="vm_image" class="dropdown"/>
                                <option value=""></option>
                                {% for image in image_list %}
                                    {% if image.name == group.vm_image %}
                                        <option value="{{ image.name }}" selected>{{ image.name }}</option>
                                    {% else %}
                                        <option value="{{ image.name }}">{{ image.name }}</option>
                                    {% endif %}
                                {% endfor %}

                                <tr class="highlight3"><td><label for="vm_flavor">VM Flavor</label></td>
                                <td><select name="vm_flavor" class="dropdown"/>
                                <option value=""></option>
                                {% for flavor in flavor_list %}
                                    {% if flavor.name == group.vm_flavor %}
                                        <option value="{{ flavor.name }}" selected>{{ flavor.name }}</option>
                                    {% else %}
                                        <option value="{{ flavor.name }}">{{ flavor.name }}</option>
                                    {% endif %}
                                {% endfor %}

                                <tr class="highlight3"><td><label for="vm_network">VM Network</label></td>
                                <td><select name="vm_network" class="dropdown"/>
                                <option value=""></option>
                                {% for network in network_list %}
                                    {% if network.name == group.vm_network %}
                                        <option value="{{ network.name }}" selected>{{ network.name }}</option>
                                    {% else %}
                                        <option value="{{ network.name }}">{{ network.name }}</option>
                                    {% endif %}
                                {% endfor %}


                                <tr class="highlight3"><td><label for="vm_keep_alive">VM Keep Alive</label></td>
                                <td><input type="text" name="vm_keep_alive" value="{{group.vm_keep_alive}}" /></td></tr>


                                <tr>
                                    <td>
                                        <input type="submit" value="Update Group" />
                                    </td>
                                </tr>

                                
                                

                            </table>
                            
                        </form>

                        <div class="tab2">
                            <input id="{{group.group_name}}-hide" type="radio" name="tabs2">
                            <div class="tab2-hide"></div>
                        </div>


                    </div>
                </div>

                <div class="tab">
                    <input id="metadata-{{group.group_name}}" type="radio" name="tabs">
                    <label class="highlight4" for="metadata-{{group.group_name}}">Metadata</label>
                    <div class="tab-content meta-div">


                        {% for key, value in metadata_dict.items %}
                            {% if key == group.group_name %}

                                {% if value|length > 0%}

                                    {% for meta, value2 in value.items %}

                                        <div class="tab2">
                                            <input id="metadata-{{group.group_name}}-{{meta}}" type="radio" name="tabs2" onclick="meta_fetch('{{group.group_name}}', '{{meta}}')">
                                            <label class="highlight4" for="metadata-{{group.group_name}}-{{meta}}">{{meta}}</label>
                                            <div class="tab2-content">

                                                <iframe id="editor-{{group.group_name}}-{{meta}}" class="iframe-content" src=""></iframe>

                                            </div>

                                        </div>


                                    {% endfor %}


                                {% endif %}

                            {% endif %}


                        {% endfor %}


                        <div class="tab2">
                            <input id="metadata-add" type="radio" name="tabs2" onclick="meta_add()">
                            <label class="highlight4" for="metadata-add">+</label>
                            <div class="tab2-content">

                                <iframe id="editor-add"  src=""></iframe>

                            </div>

                        </div>

                    </div>


                </div>


            </div>
            
        </div>
        
    {% endfor %}


        
    </div>

</div>

<div class="footer"
    {% if response_code == 1 %}
        <tr><td><b>Error: {{ message }}</b></td></tr>
    {% elif message is not None %}
        <tr><td>{{ message }}</td></tr>
    {% endif %}
</div>


</body>

