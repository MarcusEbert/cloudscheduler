<html>
  <head>
  {% load static %}

  <link rel="stylesheet" type="text/css" href="{% static "csv2/common.css" %}">
  <link rel="stylesheet" type="text/css" href="{% static "csv2/vms.css" %}">

  <!-- <meta http-equiv="refresh" content="30"> -->
  </head>


  <body class="vms-nav">

    <!-- {% if err_message is not None %}
        <p style="color:red;">{{err_message}}</p>
    {% endif %}
    {% if message is not None %}
        <p style="color:green;">{{message}}</p>
    {% endif %} -->

    <!-- <div class="main-div"> -->
    <div class="vm-div">
      <form method="post">
        {% csrf_token %}
        <div class="vm-buttons">
        <!-- Hide the action buttons if the looking at foreing VMs since -->
        {% if "foreign" not in request.path %}
          <button type="submit" formaction="/vm/update/" name="vm_option" value="retire">Retire VMs</button>
          <button type="submit" formaction="/vm/update/" name="vm_option" value="kill">Kill VMs</button>
          <button type="submit" formaction="/vm/update/" name="vm_option" value="manctl">Manual Control</button>
          <button type="submit" formaction="/vm/update/" name="vm_option" value="sysctl">System Control</button>

          <!-- <p>{{ request.POST }}</p> -->
        {% endif %}
        </div>
        <div class=vm-table>
          <table>
            <thead>
              <tr>
                <th style="width:25px"><input id="select-all" type="checkbox"/></th>
                <th style="width:150px">Cloud</th>
                <th style="width:100px">Project</th>
                <th style="width:450px">Hostname</th>
                <th style="width:100px">Status</th>
                <th style="width:200px">Status Changed Time</th>
                <th style="width:150px">Flavor Name</th>
                <th style="width:100px">Slots</th>
                <th style="width:150px">Slots Used</th>
                <th style="width:90px">Cores</th>
              </tr>
            </thead>

            <tbody>
              {% for vm in vm_list %}
                <tr>
                  <td style="width:25px"><input type="checkbox" name="hostname.{{ forloop.counter }}" value={{vm.hostname}}></td>
                  <td style="width:150px">{{vm.cloud_name}}</td>
                  <td style="width:100px">{{vm.project}}</td>
                  <td style="width:450px">{{vm.hostname}}</td>
                  <td style="width:100px">{{vm.poller_status}}</td>
                  <td style="width:200px">{{vm.status_changed_time}}</td>
                  <td style="width:150px">{{vm.flavor_name}}</td>
                  <td style="width:100px">{{vm.condor_slots}}</td>
                  <td style="width:150px">{{vm.condor_slots_used}}</td>
                  <td style="width:90px">{{vm.cores}}</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </form>
    </div>
    <!-- Footer -->
    <div class="footer"
        {% if response_code == 1 %}
            <tr><td><b>Error: {{ message }}</b></td></tr>
        {% elif message is not None %}
            <tr><td>{{ message }}</td></tr>
        {% endif %}
    </div>

    <script type="text/javascript">
      function checkToggle(event) {
        var changed = event.target,
          selectAll = document.getElementById('select-all'),
          checkboxes = Array.prototype.slice.call(
            this.querySelectorAll('input[type=checkbox]')
          ).filter(function(check) {
            return check !== selectAll;
          });

        if (changed === selectAll) {
          checkboxes.forEach(function(check) {
            check.checked = selectAll.checked;
          });
        } else {
          var allChecked = checkboxes.filter(function(check) {
            return check.checked;
          }).length === checkboxes.length;

          selectAll.checked = allChecked;
        }

      }

      var tableElement = document.querySelector('table');
      tableElement.addEventListener('change', checkToggle);

    </script>
  </body>
</html>
