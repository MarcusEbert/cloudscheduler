<html>
  <head>
  {% load static %}

  <link rel="stylesheet" type="text/css" href="{% static "csv2/common.css" %}">
  <link rel="stylesheet" type="text/css" href="{% static "csv2/vms.css" %}">

  <!-- <meta http-equiv="refresh" content="30"> -->
  </head>

  {% block navbar %}
     {% include "csv2/navigation_bar.html" %}
  {% endblock %}

  <body class="vms-nav">

    {% if err_message is not None %}
        <p style="color:red;">{{err_message}}</p>
    {% endif %}
    {% if message is not None %}
        <p style="color:green;">{{message}}</p>
    {% endif %}

    <div class="main-div">
      <form method="post">
        <!-- Table Setup - thead and tbody are commented out. Enable for static header
        but good luck getting the column widths to match. -->
        <button type="submit" name="vm_option" value="retire">Retire VMs</button>
        <button type="submit" formaction="/vm/update/::::/" name="vm_option" value="test">Kill VMs</button>

        <div class="vm-table">
          <table>
            <!-- <thead> -->
              <tr>
                <th><input id="select-all" type="checkbox"/></th>
                <th>Cloud</th>
                <th>Project</th>
                <th>Hostname</th>
                <!-- <th>VM ID</th> -->
                <th>Status</th>
                <th>Status Changed Time</th>
                <th>Task</th>
                <th>Flavor Name</th>
                <th>Condor Slots</th>
                <th>Condor Off</th>
                <th>Foreign</th>
                <!-- <th>Cores</th> -->
                <!-- <th>RAM</th> -->
                <!-- <th>SWAP</th> -->
                <!-- <th>Disk</th> -->
                <!-- <th>Ephemeral Disk</th> -->
                <!-- <th>Terminate</th> -->
                <!-- <th>Terminate Time</th> -->
                <!-- <th>Poller Status</th> -->
              </tr>
            <!-- </thead> -->

            <!-- <tbody> -->
              {% for vm in vm_list %}
                <tr>
                  <td><input type="checkbox" name="vm_list" value={{vm.vmid}}/></td>
                  <td>{{vm.cloud_name}}</td>
                  <td>{{vm.project}}</td>
                  <td>{{vm.hostname}}</td>
                  <!-- <td>{{vm.vmid}}</td> -->
                  <td>{{vm.status}}</td>
                  <td>{{vm.status_changed_time}}</td>
                  <td>{{vm.task}}</td>
                  <td>{{vm.flavor_name}}</td>
                  <td>{{vm.condor_slots}}</td>
                  <td>{{vm.condor_off}}</td>
                  <td>{{vm.foreign_vm}}</td>
                  <!-- <td>{{vm.cores}}</td> -->
                  <!-- <td>{{vm.ram}}</td> -->
                  <!-- <td>{{vm.swap}}</td> -->
                  <!-- <td>{{vm.disk}}</td> -->
                  <!-- <td>{{vm.ephemeral_disk}}</td> -->
                  <!-- <td>{{vm.terminate}}</td> -->
                  <!-- <td>{{vm.terminate_time}}</td> -->
                  <!-- <td>{{vm.poller_status}}</td> -->
                </tr>
              {% endfor %}
            <!-- </tbody> -->
          </table>
        </form>
      </div>
    </div>
    <!-- Footer -->
    <div class="footer"
        {% if response_code == 1 %}
            <tr><td><b>Error: {{ message }}</b></td></tr>
        {% elif message is not None %}
            <tr><td>{{ message }}</td></tr>
        {% endif %}
    </div>

    <script type="text/javascript">
      function checkToggle(event) {
        var changed = event.target,
          selectAll = document.getElementById('select-all'),
          checkboxes = Array.prototype.slice.call(
            this.querySelectorAll('input[type=checkbox]')
          ).filter(function(check) {
            return check !== selectAll;
          });

        if (changed === selectAll) {
          checkboxes.forEach(function(check) {
            check.checked = selectAll.checked;
          });
        } else {
          var allChecked = checkboxes.filter(function(check) {
            return check.checked;
          }).length === checkboxes.length;

          selectAll.checked = allChecked;
        }

      }

      var tableElement = document.querySelector('table');
      tableElement.addEventListener('change', checkToggle);

    </script>
  </body>
</html>
