<html>
  <head>
  {% load static %}

  <link rel="stylesheet" type="text/css" href="{% static "csv2/common.css" %}">
  <link rel="stylesheet" type="text/css" href="{% static "csv2/vms.css" %}">

  <!-- <meta http-equiv="refresh" content="30"> -->
  </head>


  <body class="vms-nav">

    {% if err_message is not None %}
        <p style="color:red;">{{err_message}}</p>
    {% endif %}
    {% if message is not None %}
        <p style="color:green;">{{message}}</p>
    {% endif %}

    <!-- <div class="main-div"> -->
    <div class="vm-div">
      <form method="post">
        {% csrf_token %}
        <div class="vm-buttons">
        <!-- Hide the action buttons if the looking at foreing VMs since -->
        {% if "foreign" not in request.path %}
          <button type="submit" formaction="/vm/update" name="vm_option" value="retire">Retire VMs</button>
          <button type="submit" formaction="/vm/update" name="vm_option" value="kill">Kill VMs</button>
          <button type="submit" formaction="/vm/update" name="vm_option" value="manctl">Manual Control</button>
          <button type="submit" formaction="/vm/update" name="vm_option" value="sysctl">System Control</button>

          <!-- <p>{{ request.POST }}</p> -->
        {% endif %}
        </div>
        <div class=vm-table>
          <table>
            <thead>
              <tr>
                <th><input id="select-all" type="checkbox"/></th>
                <th>Cloud</th>
                <th>Project</th>
                <th>Hostname</th>
                <th>Status</th>
                <th>Status Changed Time</th>
                <th>Flavor Name</th>
                <th>Condor Slots</th>
                <th>Condor Slots Used</th>
                <th>Cores</th>
              </tr>
            </thead>

            <tbody>
              {% for vm in vm_list %}
                <tr>
                  <td><input type="checkbox" name="hostname.{{ forloop.counter }}" value={{vm.hostname}}></td>
                  <td>{{vm.cloud_name}}</td>
                  <td>{{vm.project}}</td>
                  <td>{{vm.hostname}}</td>
                  <td>{{vm.poller_status}}</td>
                  <td>{{vm.status_changed_time}}</td>
                  <td>{{vm.flavor_name}}</td>
                  <td>{{vm.condor_slots}}</td>
                  <td>{{vm.condor_slots_used}}</td>
                  <td>{{vm.cores}}</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </form>
    </div>
    <!-- Footer -->
    <div class="footer"
        {% if response_code == 1 %}
            <tr><td><b>Error: {{ message }}</b></td></tr>
        {% elif message is not None %}
            <tr><td>{{ message }}</td></tr>
        {% endif %}
    </div>

    <script type="text/javascript">
      function checkToggle(event) {
        var changed = event.target,
          selectAll = document.getElementById('select-all'),
          checkboxes = Array.prototype.slice.call(
            this.querySelectorAll('input[type=checkbox]')
          ).filter(function(check) {
            return check !== selectAll;
          });

        if (changed === selectAll) {
          checkboxes.forEach(function(check) {
            check.checked = selectAll.checked;
          });
        } else {
          var allChecked = checkboxes.filter(function(check) {
            return check.checked;
          }).length === checkboxes.length;

          selectAll.checked = allChecked;
        }

      }

      var tableElement = document.querySelector('table');
      tableElement.addEventListener('change', checkToggle);

    </script>
  </body>
</html>
