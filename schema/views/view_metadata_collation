/*
** List all enabled group and group resource (cloud) metadata filenames together with
** identifying type (group/cloud) and sorted in user specified priority order.
*/
create or replace view view_metadata_collation as

/*
** Retrieve information.
*/

select

*

from (
    select

    cgr.group_name,
    cgr.cloud_name,
    "group" as type,
    priority,
    cgm.metadata_name

    from csv2_group_resources as cgr

    left outer join csv2_group_metadata as cgm
    on cgr.group_name=cgm.group_name

    left outer join csv2_group_resource_metadata_exceptions as cgrme on
        cgr.group_name=cgrme.group_name and
        cgr.cloud_name=cgrme.cloud_name and
        cgm.metadata_name=cgrme.metadata_name

    where cgm.enabled=1 and cgrme.group_name is null

    union all select

    group_name,
    cloud_name,
    "cloud" as type,
    priority,
    metadata_name

    from csv2_group_resource_metadata as cgrm

    where cgrm.enabled=1
    ) as gacm /*group_and_cloud_metadata */

order by gacm.group_name,gacm.cloud_name,priority,gacm.metadata_name

;
