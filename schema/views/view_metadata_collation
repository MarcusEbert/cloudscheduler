/*
** List all enabled group and group resource (cloud) metadata filenames together with
** identifying type (group/cloud) and sorted in user specified priority order.
*/
create or replace view view_metadata_collation as

/*
** Retrieve information.
*/

select

*

from (
    select

    cgr.group_name,
    cgr.cloud_name,
    "group" as type,
    priority,
    cgm.metadata_name,
    cgm.mime_type

    from csv2_group_resources as cgr

    left outer join csv2_group_metadata as cgm
    on cgr.group_name=cgm.group_name

    left outer join csv2_group_metadata_exclusions as cgme on
        cgr.group_name=cgme.group_name and
        cgm.metadata_name=cgme.metadata_name and
        cgr.cloud_name=cgme.cloud_name

    where cgm.enabled=1 and cgme.group_name is null

    union all select

    group_name,
    cloud_name,
    "cloud" as type,
    priority,
    metadata_name,
    mime_type

    from csv2_group_resource_metadata as cgrm

    where cgrm.enabled=1
    ) as gacm /*group_and_cloud_metadata */

order by group_name,cloud_name,priority,metadata_name

;
