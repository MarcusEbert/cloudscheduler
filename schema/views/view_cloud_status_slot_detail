/*
** Count the slots of each size.
*/
create or replace view view_cloud_status_slot_detail as
select
case when instr(machine,'--')=0 then
    "-"
else
    substring_index(machine,'--',1)
end as group_name,
case when instr(machine,'--')=0 then
    "-"
else
    substring_index(substring_index(machine,'--',2),'--',-1)
end as cloud_name,
substring(substring_index(name,'@',1),5) as slot_id,
slot_CPUs as slot_type,
sum(1) as slot_count,
sum(slot_CPUs) as core_count
from condor_machines as cm
where  state="Claimed"
group by group_name,cloud_name,slot_type,slot_id
;
