/*
** List redundant condor machines; condor_machines with no matching csv2_vms.
*/
create or replace view view_redundant_machines as

/*
** Retrieve information.
*/

select

cm.group_name,
cm.hostname,
cm.condor_host,
cm.name,
cm.entered_current_state,
cv.cloud_name

from (
    select

    group_name,
    machine,
    substring_index(machine,'.',1) as hostname,
    condor_host,
    name,
    entered_current_state

    from condor_machines

    where  slot_type="Partitionable"
    ) as cm /* condor_machines */

left outer join csv2_vms as cv on
    cm.group_name=cv.group_name and
    (cm.machine=cv.hostname or cm.hostname=cv.hostname)

where cv.cloud_name is null

;
